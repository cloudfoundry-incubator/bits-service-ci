# SOFTLAYER CPI

- type: replace
  path: /resource_pools/name=vms/stemcell?
  value:
    url: https://bosh.io/d/stemcells/bosh-softlayer-xen-ubuntu-trusty-go_agent?v=3421.11.5
    sha1: b10cdc25cc2daf2ce2bb6b3c6f539579c0ff6ba0

- type: replace
  path: /releases/-
  value:
    name: bosh-softlayer-cpi
    url: https://bosh.io/d/github.com/cloudfoundry/bosh-softlayer-cpi-release?v=23
    sha1: 960f6068c7823bc3822c5e7ec6c855060c5582d0

- type: replace
  path: /cloud_provider/properties/softlayer?
  value: *softlayer

- type: replace
  path: /cloud_provider/template?
  value: {name: softlayer_cpi, release: bosh-softlayer-cpi}

- type: replace
  path: /instance_groups/name=bosh/jobs/-
  value:
    name: "softlayer_cpi"
    release: "bosh-softlayer-cpi"

- type: replace
  path: /instance_groups/name=bosh/properties/softlayer?
  value: &softlayer
    username: ((softlayer_username))
    apiKey: ((softlayer_api_key))

- type: replace
  path: /instance_groups/name=bosh/properties/director/cpi_job?
  value: softlayer_cpi

- type: replace
  path: /resource_pools/name=vms/cloud_properties?
  value:
    domain: ((softlayer_domain))
    vmNamePrefix: ((director_vm_prefix))
    ephemeralDiskSize: 100
    startCpus: 4
    maxMemory: 8192
    datacenter:
      name: ((softlayer_datacenter_name))
    hourlyBillingFlag: true
    deployedByBoshcli: true
    PrimaryNetworkComponent:
      NetworkVlan:
        Id: ((softlayer_public_vlan_id))
    PrimaryBackendNetworkComponent:
      NetworkVlan:
        Id: ((softlayer_private_vlan_id))
    networkComponents:
    - MaxSpeed: 1000

# NETWORKS
- type: remove
  path: /instance_groups/name=bosh/networks/name=default/static_ips

- type: replace
  path: /networks/name=default
  value:
    name: default
    type: dynamic
    dns: [8.8.8.8]

- type: replace
  path: /instance_groups/name=bosh/properties/agent/mbus
  # probably director_hostname does not really matter here
  value: nats://nats:((nats_password))@((director_vm_prefix)).((softlayer_domain)):4222
- type: replace
  path: /cloud_provider/mbus
  value: https://mbus:((mbus_bootstrap_password))@((director_vm_prefix)).((softlayer_domain)):6868
- type: replace
  path: /variables/name=director_ssl/options/common_name
  value: ((director_vm_prefix)).((softlayer_domain))

# It's unclear why we need this here. 
# - type: replace
#   path: /variables/name=nats_server_tls/options/alternative_names?
#   value:
#   # - 127.0.0.1
#   # - 10.254.50.4
#   - ((director_vm_prefix)).((softlayer_domain))

# Needed, because we talk to the director through its softlayer hostname
- type: replace
  path: /variables/name=mbus_bootstrap_ssl/options/alternative_names?/-
  value: ((director_vm_prefix)).((softlayer_domain))

# Softlayer specific. Needed so client can talk to agent on director.
- type: replace
  path: /resource_pools/name=vms/env/bosh/keep_root_password?
  value: true
